<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Endless Space Journey - Ultra Stars</title>
<style>
    body { margin: 0; overflow: hidden; background: black; }
    #overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: radial-gradient(circle at center, #4da6ff, #000);
        color: white;
        font-size: 22px;
        cursor: pointer;
        transition: opacity 2s ease;
        z-index: 10;
    }
</style>
</head>
<body>

<div id="overlay">Click to Launch</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene, camera, renderer;
let objects = [];
let starField;
let started = false;
let speed = 1.0;

init();
animate();

function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 10000);
    camera.position.z = 10;

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    const sunLight = new THREE.PointLight(0xffffff, 2);
    sunLight.position.set(20, 10, 10);
    scene.add(sunLight);

    createEarth();
    createPlanet("moon", 0.8, -50);
    createPlanet("mars", 1.5, -120);
    createPlanet("jupiter", 4, -250);
    createSaturn(-400);

    createUltraStars();

    document.getElementById("overlay").onclick = () => {
        started = true;
        document.getElementById("overlay").style.opacity = 0;
        setTimeout(() => {
            document.getElementById("overlay").style.display = "none";
        }, 2000);
    };
}

function createEarth() {
    const geo = new THREE.SphereGeometry(3, 64, 64);
    const mat = new THREE.MeshPhongMaterial({
        map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg')
    });
    const earth = new THREE.Mesh(geo, mat);
    earth.position.z = -20;
    scene.add(earth);
    objects.push(earth);
}

function createPlanet(type, size, zPos) {
    const textures = {
        moon: 'https://threejs.org/examples/textures/planets/moon_1024.jpg',
        mars: 'https://threejs.org/examples/textures/planets/mars_1024.jpg',
        jupiter: 'https://threejs.org/examples/textures/planets/jupiter_1024.jpg'
    };
    const geo = new THREE.SphereGeometry(size, 32, 32);
    const mat = new THREE.MeshPhongMaterial({ map: new THREE.TextureLoader().load(textures[type]) });
    const planet = new THREE.Mesh(geo, mat);
    planet.position.set((Math.random()-0.2)*20, (Math.random()-0.5)*10, zPos);
    scene.add(planet);
    objects.push(planet);
}

function createSaturn(zPos) {
    const geo = new THREE.SphereGeometry(3, 32, 32);
    const mat = new THREE.MeshPhongMaterial({
        map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/saturn.jpg')
    });
    const saturn = new THREE.Mesh(geo, mat);
    saturn.position.set((Math.random()-0.5)*20, (Math.random()-0.5)*10, zPos);

    const ringGeo = new THREE.RingGeometry(4, 6, 64);
    const ringMat = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/saturnringcolor.jpg'),
        side: THREE.DoubleSide,
        transparent: true
    });
    const rings = new THREE.Mesh(ringGeo, ringMat);
    rings.rotation.x = Math.PI / 2;
    saturn.add(rings);

    scene.add(saturn);
    objects.push(saturn);
}

// ----------- ULTRA STARFIELD -----------
function createUltraStars() {
    const geometry = new THREE.BufferGeometry();
    const positions = [];
    const starCount = 9000000; // dense starfield

    for (let i = 0; i < starCount; i++) {
        positions.push(
            (Math.random()-0.2)*8000,
            (Math.random()-0.2)*8000,
            (Math.random()-0.2)*8000
        );
    }

    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

    const sprite = new THREE.TextureLoader().load("https://threejs.org/examples/textures/sprites/disc.png");
    const material = new THREE.PointsMaterial({ size: 1, map: sprite, transparent: true, depthWrite: false });
    starField = new THREE.Points(geometry, material);
    scene.add(starField);
}

// ----------- ANIMATION LOOP -----------
function animate() {
    requestAnimationFrame(animate);

    if (started) {
        objects.forEach(obj => {
            obj.position.z += speed;
            obj.rotation.y += 0.02;
            if (obj.position.z > 1000) {
                obj.position.z = -200 - Math.random()*10000;
                obj.position.x = (Math.random()-0.2)*1000;
                obj.position.y = (Math.random()-0.2)*1000;
            }
        });

        starField.position.z += speed*0.2;
        if (starField.position.z > 400) starField.position.z = 0;
    }

    renderer.render(scene, camera);
}
</script>
</body>
</html>